(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[698],{63:(e,t,s)=>{"use strict";var a=s(7260);s.o(a,"usePathname")&&s.d(t,{usePathname:function(){return a.usePathname}}),s.o(a,"useRouter")&&s.d(t,{useRouter:function(){return a.useRouter}}),s.o(a,"useSearchParams")&&s.d(t,{useSearchParams:function(){return a.useSearchParams}})},1289:(e,t,s)=>{"use strict";s.d(t,{N:()=>a});let a=(0,s(1993).UU)("https://ogqjfeumqaaxorxrehxd.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9ncWpmZXVtcWFheG9yeHJlaHhkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTk5MzcxOTUsImV4cCI6MjA3NTUxMzE5NX0.5EgofBpIzK_MyB4fRnTSLCxP3nMCznR5PIJ3kD0xjPk")},3054:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>z});var a=s(5155),i=s(2115),l=s(63),n=s(1289);async function r(e,t){let{error:s}=await n.N.rpc("mark_claim_picked_up",{p_claim_id:e,p_admin:t});if(s)throw s}async function c(e,t,s){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};try{var i,l;let{data:r}=await n.N.auth.getUser(),c=null!=(l=null==r||null==(i=r.user)?void 0:i.id)?l:null,d="undefined"!=typeof navigator?navigator.userAgent:null,{error:o}=await n.N.from("audit_log").insert({action:e,entity_type:t,entity_id:s,details:a,user_agent:d,actor_uid:c});o&&console.warn("audit log insert failed:",o.message)}catch(e){console.warn("audit log insert failed:",e)}}let d="#b10015",o="#0f2741",m="#f1f5fb",u="claim-photos",x="data:image/svg+xml;utf8,"+encodeURIComponent("<svg xmlns='http://www.w3.org/2000/svg' width='120' height='90'>\n      <rect width='100%' height='100%' fill='#f3f4f6'/>\n      <text x='50%' y='52%' dominant-baseline='middle' text-anchor='middle'\n            font-family='system-ui, -apple-system, Segoe UI, Roboto, sans-serif'\n            font-size='12' fill='#9ca3af'>no image</text>\n    </svg>");function h(e){let{label:t,children:s}=e;return(0,a.jsxs)("label",{className:"grid gap-1 text-sm",children:[(0,a.jsx)("span",{className:"text-gray-700",children:t}),s]})}function g(e){let{children:t}=e;return(0,a.jsx)("h2",{className:"flex items-center gap-2 text-lg font-semibold",children:t})}function p(e){let{children:t,className:s=""}=e;return(0,a.jsx)("div",{className:"rounded-2xl border border-gray-200 bg-white shadow-sm ".concat(s),children:t})}function f(e){let{label:t,value:s,tint:i="#f8fafc"}=e;return(0,a.jsxs)("div",{className:"rounded-2xl border border-gray-200 bg-white p-4 shadow-sm",style:{background:"linear-gradient(180deg, ".concat(i," 0%, white 60%)")},children:[(0,a.jsx)("div",{className:"text-xs text-gray-500",children:t}),(0,a.jsx)("div",{className:"mt-1 text-2xl font-semibold tracking-tight",children:s})]})}function y(e){let{children:t,active:s,onClick:i}=e;return(0,a.jsx)("button",{onClick:i,className:"rounded-full border px-3 py-1.5 text-sm shadow-sm transition ".concat(s?"text-white":"text-gray-700 hover:bg-gray-50"),style:{borderColor:s?"transparent":"#e5e7eb",background:s?"linear-gradient(135deg, ".concat(d," 0%, ").concat(o," 100%)"):"white"},children:t})}function j(e){let{children:t,className:s=""}=e;return(0,a.jsx)("div",{className:"flex items-center justify-between rounded-2xl border border-gray-200 bg-white p-4 shadow-sm ".concat(s),children:t})}function v(e){let{text:t}=e;return(0,a.jsx)("div",{className:"rounded-2xl border border-dashed border-gray-300 bg-white p-6 text-center text-sm text-gray-600",children:t})}function b(e){let{title:t,meta:s}=e;return(0,a.jsxs)("div",{className:"min-w-0",children:[(0,a.jsx)("div",{className:"truncate font-medium",children:t}),s&&(0,a.jsx)("div",{className:"mt-0.5 flex items-center gap-1 text-xs text-gray-600",children:s})]})}function N(e){let{children:t}=e;return(0,a.jsx)("div",{className:"flex shrink-0 gap-2",children:t})}function w(e){let{children:t,onClick:s,tone:i="primary",disabled:l}=e,n="rounded-full px-3 py-1.5 text-sm";return"primary"===i?(0,a.jsx)("button",{onClick:s,disabled:l,className:"".concat(n," text-white shadow-sm disabled:opacity-60"),style:{background:"linear-gradient(135deg, ".concat(d," 0%, ").concat(o," 100%)")},children:t}):"danger"===i?(0,a.jsx)("button",{onClick:s,disabled:l,className:"".concat(n," text-white shadow-sm disabled:opacity-60"),style:{background:"linear-gradient(135deg, #ef4444 0%, #7f1d1d 100%)"},children:t}):"success"===i?(0,a.jsx)("button",{onClick:s,disabled:l,className:"".concat(n," text-white shadow-sm disabled:opacity-60"),style:{background:"linear-gradient(135deg, #10b981 0%, #065f46 100%)"},children:t}):"secondary"===i?(0,a.jsx)("button",{onClick:s,disabled:l,className:"".concat(n," border text-[13px] disabled:opacity-60"),style:{color:o,borderColor:o,background:m},children:t}):(0,a.jsx)("button",{onClick:s,disabled:l,className:"".concat(n," text-gray-700 border border-gray-200 bg-white hover:bg-gray-50 disabled:opacity-60"),children:t})}function _(e){let{status:t}=e,s="claimed"===t?"bg-emerald-100 text-emerald-800":"on_hold"===t?"bg-amber-100 text-amber-800":"listed"===t?"bg-green-100 text-green-800":"pending"===t?"bg-amber-100 text-amber-800":"rejected"===t?"bg-rose-100 text-rose-800":"bg-gray-100 text-gray-800",i="claimed"===t?"Picked Up":"on_hold"===t?"On Hold":t.charAt(0).toUpperCase()+t.slice(1);return(0,a.jsx)("span",{className:"rounded-full px-2 py-0.5 text-[11px] ".concat(s),children:i})}function k(e){let{src:t,alt:s}=e;return(0,a.jsx)("div",{className:"mr-3 h-12 w-16 overflow-hidden rounded-md border border-gray-200 bg-gray-50",children:(0,a.jsx)("img",{src:t||x,alt:s||"",className:"h-full w-full object-cover",loading:"lazy"})})}function C(e){let{role:t,onSignOut:s}=e;return(0,a.jsx)("header",{className:"w-full",style:{background:"linear-gradient(135deg, ".concat(d," 0%, ").concat(o," 100%)")},children:(0,a.jsxs)("div",{className:"mx-auto flex max-w-6xl flex-col gap-4 px-6 py-6 text-white sm:flex-row sm:items-center sm:justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-2xl font-semibold tracking-tight",children:"Admin Dashboard"}),(0,a.jsx)("p",{className:"text-sm text-white/80",children:"Creek Lost & Found • moderation & insights"})]}),(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[t&&(0,a.jsxs)("span",{className:"rounded-full bg-white/10 px-2 py-1 text-xs ring-1 ring-white/20",children:["Signed in as ",(0,a.jsx)("strong",{className:"font-semibold",children:t})]}),(0,a.jsx)("button",{onClick:s,className:"rounded-full bg-white px-3 py-1.5 text-[13px] font-medium text-gray-900 shadow hover:bg-white/90",children:"Sign out"})]})]})})}var S=s(7650);function E(e){let{children:t}=e;return"undefined"==typeof document?null:S.createPortal(t,document.body)}function I(e){(0,i.useEffect)(()=>{if(!e)return;let t=document.documentElement,s=document.body,a=window.scrollY;return s.style.position="fixed",s.style.top="-".concat(a,"px"),s.style.left="0",s.style.right="0",s.style.width="100%",t.style.overscrollBehavior="none",()=>{s.style.position="",s.style.top="",s.style.left="",s.style.right="",s.style.width="",t.style.overscrollBehavior="",window.scrollTo(0,a)}},[e])}function A(e){let{title:t,onClose:s,children:i}=e;return I(!0),(0,a.jsx)(E,{children:(0,a.jsxs)("div",{className:"fixed inset-0 z-[100]",children:[(0,a.jsx)("div",{className:"fixed inset-0 bg-black/40",onClick:s}),(0,a.jsx)("div",{className:"fixed inset-0 overflow-y-auto",children:(0,a.jsx)("div",{className:"flex min-h-screen items-center justify-center p-4",children:(0,a.jsxs)("div",{className:"w-[95%] max-w-lg rounded-2xl border border-gray-200 bg-white shadow-2xl",children:[(0,a.jsx)("div",{className:"rounded-t-2xl px-4 py-3 text-white",style:{background:"linear-gradient(135deg, ".concat(d," 0%, ").concat(o," 100%)")},children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("h3",{className:"text-base font-semibold",children:t}),(0,a.jsx)("button",{className:"text-sm text-white/90 hover:text-white",onClick:s,children:"Close"})]})}),(0,a.jsx)("div",{className:"p-4",children:i})]})})})]})})}function P(e){let{open:t,title:s,children:l,confirmLabel:n="Confirm",cancelLabel:r="Cancel",onConfirm:c,onCancel:m,busy:u=!1}=e;return(I(t),(0,i.useEffect)(()=>{function e(e){t&&("Escape"===e.key&&m(),"Enter"===e.key&&c())}return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[t,m,c]),t)?(0,a.jsx)(E,{children:(0,a.jsxs)("div",{className:"fixed inset-0 z-[100]",children:[(0,a.jsx)("div",{className:"fixed inset-0 bg-black/40",onClick:m}),(0,a.jsx)("div",{className:"fixed inset-0 overflow-y-auto",children:(0,a.jsx)("div",{className:"flex min-h-screen items-center justify-center p-4",children:(0,a.jsxs)("div",{className:"w-[95%] max-w-md overflow-hidden rounded-2xl border border-gray-200 bg-white shadow-2xl",children:[(0,a.jsx)("div",{className:"px-4 py-3 text-white",style:{background:"linear-gradient(135deg, ".concat(d," 0%, ").concat(o," 100%)")},children:(0,a.jsx)("h3",{className:"text-base font-semibold",children:s})}),(0,a.jsx)("div",{className:"p-4 text-sm text-gray-800",children:l}),(0,a.jsxs)("div",{className:"flex justify-end gap-2 p-4 pt-0",children:[(0,a.jsx)("button",{onClick:m,disabled:u,className:"rounded-md border border-gray-200 px-4 py-2 text-sm hover:bg-gray-50",children:r}),(0,a.jsx)("button",{onClick:c,disabled:u,className:"rounded-md px-4 py-2 text-sm font-semibold text-white shadow-md disabled:opacity-60",style:{backgroundColor:d},children:u?"Working…":n})]})]})})})]})}):null}function L(e){let{claim:t,meIsStaff:s,onClose:l}=e;I(!0);let[r,m]=(0,i.useState)([]),[u,x]=(0,i.useState)(""),[h,g]=(0,i.useState)(!1),p=(0,i.useRef)(null),[f,y]=(0,i.useState)(null);async function j(){var e;let a=u.trim();if(!a||!f)return;g(!0);let i={id:Date.now(),claim_id:t.id,sender_uid:f,sender_role:s?"staff":"claimant",body:a,created_at:new Date().toISOString(),seen_by_claimant:!s,seen_by_staff:!!s};m(e=>[...e,i]),x("");let{data:l,error:r}=await n.N.from("claim_messages").insert({claim_id:t.id,sender_uid:f,sender_role:s?"staff":"claimant",body:a,seen_by_claimant:!s,seen_by_staff:!!s}).select("id").single();if(r){m(e=>e.filter(e=>e.id!==i.id)),alert("Send failed: ".concat(r.message)),x(a),g(!1);return}await c("message_sent","message",null!=(e=null==l?void 0:l.id)?e:null,{claim_id:t.id}),g(!1)}return(0,i.useEffect)(()=>{(async()=>{var e,s,a,i;let{data:l}=await n.N.auth.getUser();y(null!=(a=null==(e=l.user)?void 0:e.id)?a:null);let{data:r}=await n.N.from("claim_messages").select("*").eq("claim_id",t.id).order("created_at",{ascending:!0});m(r||[]),await n.N.from("claim_messages").update({seen_by_staff:!0}).eq("claim_id",t.id).neq("sender_uid",null!=(i=null==(s=l.user)?void 0:s.id)?i:"")})()},[t.id]),(0,i.useEffect)(()=>{let e=n.N.channel("claim_messages:claim:".concat(t.id)).on("postgres_changes",{event:"INSERT",schema:"public",table:"claim_messages",filter:"claim_id=eq.".concat(t.id)},e=>{if(m(t=>[...t,e.new]),s){let t=e.new;t.sender_uid!==f&&n.N.from("claim_messages").update({seen_by_staff:!0}).eq("id",t.id)}}).subscribe();return()=>{n.N.removeChannel(e)}},[t.id,s,f]),(0,i.useEffect)(()=>{var e;null==(e=p.current)||e.scrollTo({top:1e9,behavior:"smooth"})},[r.length]),(0,a.jsx)(E,{children:(0,a.jsxs)("div",{className:"fixed inset-0 z-[100]",children:[(0,a.jsx)("div",{className:"fixed inset-0 bg-black/40",onClick:l}),(0,a.jsx)("div",{className:"fixed inset-0 overflow-y-auto",children:(0,a.jsx)("div",{className:"flex min-h-screen items-center justify-center p-4",children:(0,a.jsxs)("div",{className:"flex w-[95%] max-w-2xl flex-col overflow-hidden rounded-2xl border border-gray-200 bg-white shadow-2xl",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between px-4 py-3 text-white",style:{background:"linear-gradient(135deg, ".concat(d," 0%, ").concat(o," 100%)")},children:[(0,a.jsxs)("div",{className:"text-sm",children:[(0,a.jsxs)("div",{className:"font-semibold",children:["Claim #",t.id]}),(0,a.jsxs)("div",{className:"text-white/80",children:[t.claimant_name," (",t.claimant_email,")"]})]}),(0,a.jsx)("button",{className:"rounded px-3 py-1 text-sm text-white hover:bg-white/10",onClick:l,children:"Close"})]}),(0,a.jsxs)("div",{ref:p,className:"max-h-[60vh] min-h-[40vh] overflow-y-auto bg-gray-50 p-4",children:[0===r.length&&(0,a.jsx)("div",{className:"py-10 text-center text-sm text-gray-500",children:"No messages yet. Say hi \uD83D\uDC4B"}),(0,a.jsx)("div",{className:"space-y-2",children:r.map(e=>{let t=e.sender_uid===f;return(0,a.jsx)("div",{className:"flex ".concat(t?"justify-end":"justify-start"),children:(0,a.jsxs)("div",{className:"max-w-[80%] rounded-2xl px-3 py-2 text-sm ".concat(t?"bg-indigo-600 text-white":"bg-white text-gray-800 border border-gray-200"),children:[(0,a.jsx)("div",{className:"whitespace-pre-wrap",children:e.body}),(0,a.jsx)("div",{className:"mt-1 text-[10px] ".concat(t?"text-white/80":"text-gray-500"),children:new Date(e.created_at).toLocaleString()})]})},e.id)})})]}),(0,a.jsxs)("div",{className:"border-t border-gray-200 p-3",children:[(0,a.jsx)("textarea",{className:"h-20 w-full resize-none rounded-xl border px-3 py-2 text-sm outline-none focus:ring-2",placeholder:"Type a message… (Enter to send, Shift+Enter for new line)",value:u,onChange:e=>x(e.target.value),onKeyDown:function(e){"Enter"!==e.key||e.shiftKey||(e.preventDefault(),j())},disabled:h}),(0,a.jsx)("div",{className:"mt-2 flex items-center justify-end",children:(0,a.jsx)("button",{onClick:j,disabled:h||0===u.trim().length,className:"rounded-full bg-indigo-600 px-4 py-1.5 text-sm font-medium text-white shadow disabled:opacity-60",children:h?"Sending…":"Send"})})]})]})})})]})})}async function D(){var e;let{data:t}=await n.N.auth.getUser();return null==(e=t.user)?void 0:e.id}async function O(e,t){let{data:s,error:a}=await n.N.rpc("approve_claim",{p_claim_id:e,p_admin:t});if(a)throw a;return Array.isArray(s)?s[0]:void 0}async function U(e,t,s){let{error:a}=await n.N.rpc("reject_claim",{p_claim_id:e,p_admin:t,p_reason:null!=s?s:null});if(a)throw a}async function R(e){let{data:t,error:s}=await n.N.from("claims").select("id, item_id, status, pickup_code, created_at").eq("item_id",e).order("created_at",{ascending:!1}).limit(1).maybeSingle();if(s)throw s;return t}function T(e,t){if(!t)return x;if(/^https?:\/\//i.test(t))return t;let{data:s}=n.N.storage.from(e).getPublicUrl(t);return(null==s?void 0:s.publicUrl)||x}function z(){var e,t,s,S;let E=(0,l.useRouter)(),[I,z]=(0,i.useState)(null),[M,F]=(0,i.useState)([]),[J,B]=(0,i.useState)([]),[H,V]=(0,i.useState)(!0),[Q,X]=(0,i.useState)("pending"),[W,Z]=(0,i.useState)(""),[K,Y]=(0,i.useState)(!1),[G,$]=(0,i.useState)(null),[ee,et]=(0,i.useState)({}),[es,ea]=(0,i.useState)(!1),[ei,el]=(0,i.useState)(!1),[en,er]=(0,i.useState)(null),{add:ec,node:ed}=function(){let[e,t]=(0,i.useState)([]),s=e=>t(t=>t.filter(t=>t.id!==e)),l=(0,a.jsx)("div",{className:"fixed right-3 top-3 z-[120] space-y-2",children:e.map(e=>(0,a.jsxs)("div",{className:"flex items-center gap-3 rounded-md bg-gray-900/95 px-3 py-2 text-sm text-white shadow-lg",children:[(0,a.jsx)("span",{children:e.msg}),e.actionLabel&&(0,a.jsx)("button",{className:"rounded border border-white/20 px-2 py-0.5 text-xs hover:bg-white/10",onClick:()=>{var t;null==(t=e.onAction)||t.call(e),s(e.id)},children:e.actionLabel}),(0,a.jsx)("button",{onClick:()=>s(e.id),className:"ml-1 rounded px-2 py-0.5 text-xs text-white/70 hover:bg-white/10",children:"✕"})]},e.id))});return{add:(e,a)=>{var i;let l=Date.now()+Math.floor(1e3*Math.random());t(t=>[...t,{id:l,msg:e,...a}]);let n=null!=(i=null==a?void 0:a.ttl)?i:3e3;return(null==a?void 0:a.onAction)||setTimeout(()=>s(l),n),l},remove:s,node:l}}(),[eo,em]=(0,i.useState)({}),[eu,ex]=(0,i.useState)(!1),[eh,eg]=(0,i.useState)(""),[ep,ef]=(0,i.useState)([]),[ey,ej]=(0,i.useState)(!1),[ev,eb]=(0,i.useState)(null),[eN,ew]=(0,i.useState)(""),[e_,ek]=(0,i.useState)(!1),[eC,eS]=(0,i.useState)(!1),[eE,eI]=(0,i.useState)(null),[eA,eP]=(0,i.useState)(""),[eL,eD]=(0,i.useState)(!1),[eO,eU]=(0,i.useState)([]),[eR,eT]=(0,i.useState)(!0),[ez,eq]=(0,i.useState)("Overview"),[eM,eF]=(0,i.useState)(!1),[eJ,eB]=(0,i.useState)(1),[eH,eV]=(0,i.useState)(!0),eQ=async()=>{var e;V(!0);let{data:t}=await n.N.auth.getUser(),s=null==(e=t.user)?void 0:e.id;if(!s)return void E.replace("/auth/login");let{data:a,error:i}=await n.N.from("profiles").select("role").eq("uid",s).single();if(i||!a||!["admin","staff"].includes(a.role)){alert("Not authorized"),E.replace("/");return}z(a.role);let[{data:l},{data:r}]=await Promise.all([n.N.from("items").select("*").order("created_at",{ascending:!1}),n.N.from("claims").select("*").order("created_at",{ascending:!1})]);F(l||[]),B(r||[]),V(!1)};async function eX(){var e;let{reset:t=!1}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};eT(!0);let s=t?0:eO.length,{data:a,error:i}=await n.N.from("v_activity_unified").select("*").order("occurred_at",{ascending:!1}).range(s,s+100-1);if(i){console.error("activity fetch failed:",i),eT(!1),eF(!0);return}eU(e=>t?null!=a?a:[]:[...e,...null!=a?a:[]]),eV((null!=(e=null==a?void 0:a.length)?e:0)===100),eT(!1),eF(!0)}async function eW(){eH&&!eR&&await eX({reset:!1})}function eZ(e,t){F(s=>s.map(s=>s.id===e?{...s,status:t}:s))}(0,i.useEffect)(()=>{eQ()},[]),(0,i.useEffect)(()=>{"Activity"!==ez||eM||eX({reset:!0})},[ez,eM]),(0,i.useEffect)(()=>{let e=n.N.channel("claims-realtime").on("postgres_changes",{event:"*",schema:"public",table:"claims"},()=>{eQ()}).subscribe();return()=>{n.N.removeChannel(e)}},[]),(0,i.useEffect)(()=>{if("Activity"!==ez)return;let e=n.N.channel("audit-log-rt").on("postgres_changes",{event:"INSERT",schema:"public",table:"audit_log"},e=>{eU(t=>[e.new,...t].slice(0,200))}).subscribe();return()=>{n.N.removeChannel(e)}},[ez]),(0,i.useEffect)(()=>{let e={};for(let t of M){let s=t.photo_url;if(!s){e[t.id]=x;continue}if(/^https?:\/\//i.test(s))e[t.id]=s;else{let{data:a}=n.N.storage.from("item-photos").getPublicUrl(s);e[t.id]=(null==a?void 0:a.publicUrl)||x}}em(e)},[M]);let eK=async()=>{await n.N.auth.signOut(),z(null),F([]),B([]),E.replace("/")},eY=e=>{var t,s,a,i;$(e),et({title:null!=(t=e.title)?t:"",category:null!=(s=e.category)?s:"",...{location:null!=(a=e.location)?a:""},description:null!=(i=e.description)?i:""}),Y(!0)},eG=e=>{er(e),ea(!0)},e$=async()=>{if(!en)return;let e=en.id;el(!0),eZ(e,"listed"),ea(!1),el(!1),ec("Approved: “".concat(en.title,"”"),{actionLabel:"Undo (5s)",ttl:5e3,onAction:async()=>{await n.N.from("items").update({status:"pending"}).eq("id",e),eZ(e,"pending"),await c("item_updated","item",e,{prev_status:"listed",next_status:"pending",via:"undo"})}});let{error:t}=await n.N.from("items").update({status:"listed"}).eq("id",e);t?(eZ(e,"pending"),ec("Error listing item: ".concat(t.message))):await c("item_listed","item",e)},e0=async(e,t)=>{let{error:s}=await n.N.from("items").update({status:t}).eq("id",e);if(s)return ec("Error: ".concat(s.message));eZ(e,"rejected"),ec("Item #".concat(e," → rejected")),await c("item_rejected","item",e)},e1=async e=>{let{error:t}=await n.N.from("items").update({status:"listed"}).eq("id",e);if(t)return ec("Error: ".concat(t.message));eZ(e,"listed"),ec("Item #".concat(e," restored to Listed.")),await c("item_released_hold","item",e)};async function e2(e){let t=await D();if(!t)return ec("Not signed in.");try{let s=await O(e.id,t);if(null==s?void 0:s.pickup_code){ec("Claim #".concat(e.id," approved. Code: ").concat(s.pickup_code));try{await navigator.clipboard.writeText(s.pickup_code),ec("Pickup code copied.")}catch(e){}}else ec("Claim #".concat(e.id," approved."));await c("approve_claim","claim",e.id,{item_id:e.item_id}),eQ()}catch(e){ec("Approve failed: ".concat(e.message||e))}}async function e3(e){let t=await D();if(!t)return ec("Not signed in.");try{await U(e.id,t,"Not enough proof to verify ownership."),ec("Claim #".concat(e.id," rejected.")),await c("reject_claim","claim",e.id),eQ()}catch(e){ec("Reject failed: ".concat(e.message||e))}}async function e5(e){let t=await D();if(!t)return ec("Not signed in.");eD(!0);try{let s=await R(e);if(!(null==s?void 0:s.id))throw Error("No claim found for this item.");await r(s.id,t),ec("Claim #".concat(s.id," marked picked up ✅")),await c("mark_picked_up","claim",s.id,{item_id:e}),await eQ()}catch(e){var s;ec(null!=(s=null==e?void 0:e.message)?s:"Failed to mark picked up")}finally{eD(!1)}}async function e4(){if(!ev)return;ek(!0);let e=eN?new Date(eN).toISOString():null,{error:t}=await n.N.from("claims").update({schedule_at:e}).eq("id",ev.id);if(ek(!1),t)return ec("Error scheduling: ".concat(t.message));ec(e?"Pickup scheduled for claim #".concat(ev.id):"Pickup cleared for claim #".concat(ev.id)),await c(e?"schedule_set":"schedule_cleared","claim",ev.id,{at:e}),ej(!1),eb(null),eQ()}let e6=M.filter(e=>"pending"===e.status),e8=J.filter(e=>"pending"===e.status),e9=(0,i.useMemo)(()=>(function(e,t,s){let a={};for(let l of e){var i;let e=t.find(e=>e.id===l.item_id),n=e&&null!=(i=s[e.id])?i:x,r=[],c=l.proof;if(c&&String(c).trim())try{let e=JSON.parse(String(c));r=Array.isArray(e)?e.map(e=>T(u,e)):[T(u,String(c))]}catch(e){r=[T(u,String(c))]}a[l.id]={itemThumb:n,proofs:r}}return a})(J,M,eo),[J,M,eo]),e7=(0,i.useMemo)(()=>(function(e,t,s){let a=s.trim().toLowerCase();return e.filter(e=>{let s=e.status,i=!a||[e.id,e.title,e.category,e.location,e.description].filter(Boolean).some(e=>String(e).toLowerCase().includes(a));return("all"===t||s===t)&&i})})(M,Q,W),[M,Q,W]),{totalItems:te,totalClaims:tt,listedCount:ts,onHoldCount:ta,pendingCount:ti,rejectedCount:tl,topCats:tn,topLocs:tr}=(0,i.useMemo)(()=>(function(e,t){let s=e.length,a=t.length,i=0,l=0,n=0,r=0,c=Date.now()-2592e6,d=new Map,o=new Map;for(let t of e){var m,u,x,h;let e=t.status;"listed"===e?i++:"on_hold"===e?l++:"pending"===e?n++:"rejected"===e&&r++;let s=(null!=(m=t.category)?m:"Uncategorized").trim(),a=(null!=(u=t.location)?u:"—").trim(),g=new Date(t.created_at).getTime();!Number.isNaN(g)&&g>=c&&(d.set(s,(null!=(x=d.get(s))?x:0)+1),o.set(a,(null!=(h=o.get(a))?h:0)+1))}return{totalItems:s,totalClaims:a,listedCount:i,onHoldCount:l,returnedCount:0,pendingCount:n,rejectedCount:r,topCats:Array.from(d.entries()).sort((e,t)=>t[1]-e[1]).slice(0,3),topLocs:Array.from(o.entries()).sort((e,t)=>t[1]-e[1]).slice(0,3)}})(M,J),[M,J]);return H?(0,a.jsxs)("div",{className:"min-h-[60vh]",children:[(0,a.jsx)(C,{role:I,onSignOut:eK}),(0,a.jsxs)("div",{className:"mx-auto max-w-6xl space-y-6 p-6",children:[(0,a.jsx)("div",{className:"h-24 animate-pulse rounded-2xl bg-gray-100"}),(0,a.jsx)("div",{className:"grid grid-cols-2 gap-3 md:grid-cols-4",children:Array.from({length:4}).map((e,t)=>(0,a.jsx)("div",{className:"h-24 animate-pulse rounded-xl bg-gray-100"},t))}),(0,a.jsx)("div",{className:"h-10 animate-pulse rounded-xl bg-gray-100"}),Array.from({length:6}).map((e,t)=>(0,a.jsx)("div",{className:"h-20 animate-pulse rounded-xl bg-gray-100"},t))]})]}):(0,a.jsxs)("div",{children:[(0,a.jsx)(C,{role:I,onSignOut:eK}),(0,a.jsxs)("main",{className:"mx-auto max-w-6xl p-6",children:[(0,a.jsx)("div",{className:"flex items-center gap-2",children:["Overview","Queues","Activity"].map(e=>(0,a.jsx)("button",{onClick:()=>eq(e),className:"rounded-full px-3 py-1.5 text-sm border shadow-sm ".concat(ez===e?"text-white":"text-gray-700 hover:bg-gray-50"),style:{borderColor:ez===e?"transparent":"#e5e7eb",background:ez===e?"linear-gradient(135deg, ".concat(d," 0%, ").concat(o," 100%)"):"white"},children:e},e))}),"Overview"===ez&&(0,a.jsxs)("div",{className:"space-y-8 mt-4",children:[(0,a.jsxs)("section",{children:[(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4 md:grid-cols-4",children:[(0,a.jsx)(f,{label:"Total items",value:te,tint:m}),(0,a.jsx)(f,{label:"Total claims",value:tt,tint:"#fef2f3"}),(0,a.jsx)(f,{label:"Listed",value:ts,tint:"#eef7ff"}),(0,a.jsx)(f,{label:"On Hold",value:ta,tint:"#fff7ee"})]}),(0,a.jsxs)("div",{className:"mt-4 grid grid-cols-2 gap-4 md:grid-cols-4",children:[(0,a.jsx)(f,{label:"Pending",value:ti,tint:"#fff6e8"}),(0,a.jsx)(f,{label:"Rejected",value:tl,tint:"#fdeff0"}),(0,a.jsxs)(p,{className:"p-4",children:[(0,a.jsx)("div",{className:"mb-2 text-xs text-gray-500",children:"Top categories (30d)"}),tn.length?(0,a.jsx)("ul",{className:"space-y-1 text-sm",children:tn.map(e=>{let[t,s]=e;return(0,a.jsxs)("li",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"truncate",children:t}),(0,a.jsx)("span",{className:"ml-2 text-gray-700",children:s})]},t)})}):(0,a.jsx)("div",{className:"text-sm text-gray-600",children:"—"})]})]})]}),(0,a.jsxs)("section",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)(g,{children:"Pending Snapshot"}),(0,a.jsx)(w,{tone:"ghost",onClick:()=>eq("Queues"),children:"View all in Queues →"})]}),(0,a.jsxs)("div",{className:"grid gap-4 md:grid-cols-2",children:[(0,a.jsxs)(p,{className:"p-0",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between p-4",children:[(0,a.jsxs)("div",{className:"font-medium",children:["Pending Items"," ",(0,a.jsxs)("span",{className:"text-gray-500",children:["(",e6.length,")"]})]}),e6.length>5&&(0,a.jsx)("span",{className:"text-xs text-gray-500 pr-2",children:"showing 5"})]}),(0,a.jsx)("div",{className:"divide-y",children:0===e6.length?(0,a.jsx)("div",{className:"px-4 py-6 text-sm text-gray-600",children:"No pending items."}):e6.slice(0,5).map(e=>{var t,s;return(0,a.jsxs)(j,{className:"px-3 py-2",children:[(0,a.jsxs)("div",{className:"flex min-w-0 items-center gap-3",children:[(0,a.jsx)(k,{src:eo[e.id],alt:e.title}),(0,a.jsx)(b,{title:(0,a.jsxs)("span",{className:"block truncate max-w-[18rem] sm:max-w-[24rem]",children:["#",e.id," \xb7 ",e.title]}),meta:(0,a.jsxs)("span",{className:"block truncate text-gray-600",children:[null!=(t=e.category)?t:"—"," \xb7"," ",null!=(s=e.location)?s:"—"]})})]}),(0,a.jsxs)(N,{children:[(0,a.jsx)(w,{tone:"primary",onClick:()=>eG(e),children:"Approve"}),(0,a.jsx)(w,{tone:"danger",onClick:()=>e0(e.id,"rejected"),children:"Reject"}),(0,a.jsx)(w,{tone:"ghost",onClick:()=>eY(e),children:"Edit"})]})]},e.id)})})]}),(0,a.jsxs)(p,{className:"p-0",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between p-4",children:[(0,a.jsxs)("div",{className:"font-medium",children:["Pending Claims"," ",(0,a.jsxs)("span",{className:"text-gray-500",children:["(",e8.length,")"]})]}),e8.length>3&&(0,a.jsx)("span",{className:"text-xs text-gray-500 pr-2",children:"showing 3"})]}),(0,a.jsx)("div",{className:"divide-y",children:0===e8.length?(0,a.jsx)("div",{className:"px-4 py-6 text-sm text-gray-600",children:"No pending claims."}):e8.slice(0,3).map(e=>{var t;let s=e9[e.id],i=e.schedule_at,l=i?new Date(i).toLocaleString():null;return(0,a.jsxs)(j,{className:"px-3 py-2",children:[(0,a.jsxs)("div",{className:"flex min-w-0 items-center gap-3",children:[(0,a.jsx)(k,{src:null==s?void 0:s.itemThumb,alt:"Item #".concat(e.item_id)}),(0,a.jsx)(b,{title:(0,a.jsxs)(a.Fragment,{children:["Claim #",e.id," → Item #",e.item_id,l&&(0,a.jsx)("span",{className:"ml-2 rounded-full bg-emerald-100 px-2 py-0.5 text-[11px] text-emerald-800",children:l})]}),meta:(0,a.jsxs)(a.Fragment,{children:[e.claimant_name," (",e.claimant_email,")",e.proof&&(0,a.jsxs)(a.Fragment,{children:[" \xb7 ",(0,a.jsx)("span",{className:"text-gray-500",children:"proof attached"})]})]})})]}),(0,a.jsxs)("div",{className:"flex shrink-0 items-center gap-2",children:[(null==s||null==(t=s.proofs)?void 0:t.length)>0&&(0,a.jsxs)("button",{className:"rounded-full border border-gray-200 bg-white px-2 py-1 text-xs text-gray-700 hover:bg-gray-50",onClick:()=>{var t,a;return t="Proof photos — Claim #".concat(e.id),a=s.proofs,void(eg(t),ef(a),ex(!0))},title:"View proof photos",children:["View Proofs (",s.proofs.length,")"]}),(0,a.jsx)(w,{tone:"ghost",onClick:()=>{eI(e),eS(!0)},children:"Message"}),(0,a.jsx)(w,{tone:"ghost",onClick:()=>(function(e){eb(e);let t=e.schedule_at;ew(t?new Date(t).toISOString().slice(0,16):""),ej(!0)})(e),children:l?"Reschedule":"Schedule"}),(0,a.jsx)(w,{tone:"primary",onClick:()=>e2(e),children:"Approve"}),(0,a.jsx)(w,{tone:"danger",onClick:()=>e3(e),children:"Reject"})]})]},e.id)})})]})]})]}),(0,a.jsxs)("section",{className:"space-y-3",children:[(0,a.jsx)(g,{children:"Recent Activity"}),(0,a.jsx)(p,{children:eM?eR?(0,a.jsx)("div",{className:"p-4 text-sm text-gray-500",children:"Loading…"}):0===eO.length?(0,a.jsx)("div",{className:"p-6 text-center text-sm text-gray-600",children:"No activity yet."}):(0,a.jsx)("ul",{className:"divide-y",children:eO.slice(0,8).map(e=>(0,a.jsx)(q,{row:e},e.id))}):(0,a.jsx)("div",{className:"p-4 text-sm text-gray-500",children:"Open the Activity tab to load logs…"})}),(0,a.jsx)("div",{className:"flex justify-end",children:(0,a.jsx)(w,{tone:"ghost",onClick:()=>eq("Activity"),children:"Open full Activity Log →"})})]})]}),"Queues"===ez&&(0,a.jsx)("div",{className:"space-y-8 mt-4",children:(0,a.jsxs)("section",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between",children:[(0,a.jsx)("div",{className:"flex flex-wrap gap-2",children:["all","pending","listed","on_hold","claimed","rejected"].map(e=>(0,a.jsx)(y,{active:Q===e,onClick:()=>X(e),children:e.replace("_"," ").replace(/\b\w/g,e=>e.toUpperCase())},e))}),(0,a.jsxs)("div",{className:"relative w-full sm:w-80",children:[(0,a.jsx)("input",{value:W,onChange:e=>Z(e.target.value),placeholder:"Search items…",className:"w-full rounded-full border px-4 py-2 pl-10 outline-none focus:ring-2",style:{borderColor:"#e5e7eb"}}),(0,a.jsx)("span",{className:"pointer-events-none absolute left-3 top-1/2 -translate-y-1/2 text-gray-400",children:"\uD83D\uDD0E"})]})]}),(0,a.jsxs)("div",{className:"grid gap-3",children:[0===e7.length&&(0,a.jsx)(v,{text:"No items match your filters."}),e7.map(e=>{var t,s;let i=e.status;return(0,a.jsxs)(j,{children:[(0,a.jsxs)("div",{className:"flex min-w-0 items-center",children:[(0,a.jsx)(k,{src:eo[e.id],alt:e.title}),(0,a.jsx)(b,{title:(0,a.jsxs)("span",{className:"block truncate max-w-[18rem] sm:max-w-[28rem]",children:["#",e.id," \xb7 ",e.title]}),meta:(0,a.jsxs)("span",{className:"block truncate",children:[(0,a.jsx)(_,{status:i})," \xb7 ",null!=(t=e.category)?t:"—"," ","\xb7 ",null!=(s=e.location)?s:"—"]})})]}),(0,a.jsxs)(N,{children:["pending"===i&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(w,{tone:"primary",onClick:()=>eG(e),children:"Approve & List"}),(0,a.jsx)(w,{tone:"danger",onClick:()=>e0(e.id,"rejected"),children:"Reject"}),(0,a.jsx)(w,{tone:"ghost",onClick:()=>eY(e),children:"Edit"})]}),"listed"===i&&(0,a.jsx)(a.Fragment,{children:(0,a.jsx)(w,{tone:"ghost",onClick:()=>eY(e),children:"Edit"})}),"on_hold"===i&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("span",{className:"mr-1 text-xs text-gray-500",children:"Awaiting pickup…"}),(0,a.jsx)(w,{tone:"success",onClick:()=>e5(e.id),disabled:eL,children:eL?"Working…":"Mark Picked Up"}),(0,a.jsx)(w,{tone:"secondary",onClick:()=>e1(e.id),disabled:eL,children:"Release Hold"})]}),"claimed"===i&&(0,a.jsx)("span",{className:"text-xs text-emerald-700",children:"Picked Up \uD83C\uDF89"}),"rejected"===i&&(0,a.jsx)(w,{tone:"secondary",onClick:()=>e1(e.id),children:"Restore to Listed"})]})]},e.id)})]})]})}),"Activity"===ez&&(0,a.jsxs)("section",{className:"space-y-3 mt-4",children:[(0,a.jsx)(g,{children:"Activity Log"}),(0,a.jsx)(p,{children:!eM&&eR?(0,a.jsx)("div",{className:"p-4 text-sm text-gray-500",children:"Loading…"}):0===eO.length?(0,a.jsx)("div",{className:"p-6 text-center text-sm text-gray-600",children:"No activity yet."}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("ul",{className:"divide-y",children:eO.map(e=>{var t;return(0,a.jsx)(q,{row:e},null!=(t=e.event_id)?t:e.id)})}),(0,a.jsx)("div",{className:"p-3 flex justify-center",children:eR?(0,a.jsx)("div",{className:"text-sm text-gray-500",children:"Loading…"}):eH?(0,a.jsx)(w,{tone:"ghost",onClick:eW,children:"Load more"}):(0,a.jsx)("span",{className:"text-xs text-gray-400",children:"End of results"})})]})})]})]}),K&&G&&(0,a.jsxs)(A,{onClose:()=>Y(!1),title:"Edit Item #".concat(G.id),children:[(0,a.jsxs)("div",{className:"grid gap-3",children:[(0,a.jsx)(h,{label:"Title",children:(0,a.jsx)("input",{className:"rounded-xl border px-3 py-2",value:null!=(e=ee.title)?e:"",onChange:e=>et(t=>({...t,title:e.target.value}))})}),(0,a.jsx)(h,{label:"Category",children:(0,a.jsx)("input",{className:"rounded-xl border px-3 py-2",value:null!=(t=ee.category)?t:"",onChange:e=>et(t=>({...t,category:e.target.value}))})}),(0,a.jsx)(h,{label:"Location",children:(0,a.jsx)("input",{className:"rounded-xl border px-3 py-2",value:null!=(s=ee.location)?s:"",onChange:e=>et(t=>({...t,...{location:e.target.value}}))})}),(0,a.jsx)(h,{label:"Description",children:(0,a.jsx)("textarea",{className:"min-h-28 rounded-xl border px-3 py-2",value:null!=(S=ee.description)?S:"",onChange:e=>et(t=>({...t,description:e.target.value}))})})]}),(0,a.jsxs)("div",{className:"mt-4 flex items-center justify-end gap-2",children:[(0,a.jsx)(w,{tone:"ghost",onClick:()=>Y(!1),children:"Cancel"}),(0,a.jsx)(w,{tone:"primary",onClick:async()=>{var e,t,s,a,i;if(!G)return;let l={title:null!=(e=ee.title)?e:G.title,category:null!=(t=ee.category)?t:G.category,location:null!=(a=null!=(s=ee.location)?s:G.location)?a:null,description:null!=(i=ee.description)?i:G.description},{error:r}=await n.N.from("items").update(l).eq("id",G.id);if(r)return ec("Save failed: ".concat(r.message));Y(!1),$(null),et({}),F(e=>e.map(e=>e.id===G.id?{...e,...l}:e)),ec("Changes saved."),await c("item_updated","item",G.id,l)},children:"Save changes"})]})]}),eu&&(0,a.jsx)(A,{title:eh,onClose:()=>ex(!1),children:ep.length?(0,a.jsx)("div",{className:"grid gap-3 sm:grid-cols-2",children:ep.map((e,t)=>(0,a.jsx)("div",{className:"overflow-hidden rounded-xl border",children:(0,a.jsx)("img",{src:e,alt:"",className:"w-full object-contain"})},t))}):(0,a.jsx)("div",{className:"text-sm text-gray-600",children:"No photos attached."})}),ey&&(0,a.jsxs)(A,{title:"Schedule Pickup — Claim #".concat(null==ev?void 0:ev.id),onClose:()=>ej(!1),children:[(0,a.jsx)("div",{className:"grid gap-3",children:(0,a.jsx)(h,{label:"Date & time",children:(0,a.jsx)("input",{type:"datetime-local",value:eN,onChange:e=>ew(e.target.value),className:"rounded-xl border px-3 py-2"})})}),(0,a.jsxs)("div",{className:"mt-4 flex items-center justify-end gap-2",children:[(0,a.jsx)(w,{tone:"ghost",onClick:()=>ej(!1),children:"Cancel"}),(0,a.jsx)(w,{tone:"primary",onClick:e4,children:e_?"Saving…":"Save"})]})]}),(0,a.jsx)(P,{open:es,busy:ei,title:"Approve this item?",confirmLabel:"Approve & List",onCancel:()=>ea(!1),onConfirm:e$,children:en?(0,a.jsxs)("p",{children:["Set ",(0,a.jsxs)("strong",{children:["#",en.id]})," — “",en.title,"” to ",(0,a.jsx)("strong",{children:"listed"}),"? It will appear publicly in Search and on the home page."]}):null}),eC&&eE&&(0,a.jsx)(L,{claim:eE,meIsStaff:!0,onClose:()=>{eS(!1),eI(null)}}),ed]})}function q(e){var t,s,i,l;let{row:n}=e,r=null!=(t=n.occurred_at)?t:n.at;(null==n?void 0:n.details)&&Object.keys(n.details||{}).length&&JSON.stringify(n.details);let c=null!=(i=null!=(s=n.actor_name)?s:n.actor_uid)?i:null;return(0,a.jsxs)("li",{className:"px-3 py-2 flex items-start justify-between gap-3 text-[13px]",children:[(0,a.jsxs)("div",{className:"min-w-0 flex items-center gap-2",children:[(0,a.jsxs)("span",{className:"shrink-0 rounded-full bg-gray-100 px-2 py-0.5 text-[11px] text-gray-800",children:[n.entity_type,n.entity_id?"#".concat(n.entity_id):""]}),(0,a.jsx)("span",{className:"shrink-0 rounded-full bg-blue-100 px-2 py-0.5 text-[11px] text-blue-800",children:n.action}),(0,a.jsx)("div",{className:"min-w-0 truncate text-gray-700",children:(n.action,(l=n.details)?l.item_id?"Item #".concat(l.item_id):l.claim_id?"Claim #".concat(l.claim_id):l.pickup_code?"Pickup code: ".concat(l.pickup_code):Object.entries(l).map(e=>{let[t,s]=e;return"".concat(t,": ").concat(s)}).join(", "):null)}),c&&(0,a.jsxs)("span",{className:"shrink-0 text-[11px] text-gray-500 ml-1",children:["\xb7 ",c]})]}),(0,a.jsx)("div",{className:"shrink-0 text-[11px] text-gray-500",children:r?new Date(r).toLocaleString():""})]})}},5882:(e,t,s)=>{Promise.resolve().then(s.bind(s,3054))}},e=>{e.O(0,[993,441,255,358],()=>e(e.s=5882)),_N_E=e.O()}]);